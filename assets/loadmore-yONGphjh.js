
/**
 * 由 Kpu-mobile 提供技术支持
 * Powered by Kpu-mobile
 * https://kpu-mobile.kpui.top/
 */
    
import{_ as T}from"./index-Czg9Ols8.js";import{bo as C,bl as g,V as x,d as E,U as L,r as i,j,c as B,o as d,w as P,a as v,k as y,F as S,n as U,u as m,t as k,S as H}from"./index-CEhcQr1Q.js";const N=3,M=1e3,l=C.create({baseURL:"/",timeout:1e3*60,responseType:"json"});l.interceptors.request.use(t=>{const e=g();return t.headers&&e.isLogin&&(t.headers.Token=e.token),t.method,t});function w(t){if(t.status===401)throw g().logout(),t;let e=t.message;return e==="Network Error"?e="后端网络故障":e.includes("timeout")?e="接口请求超时":e.includes("Request failed with status code")&&(e=`接口${e.substr(e.length-3)}异常`),x.error("Error",{description:e}),Promise.reject(t)}l.interceptors.response.use(t=>{if(t.data.status===1){if(t.data.error!=="")return x.warning("Warning",{description:t.data.error}),Promise.reject(t.data)}else g().logout();return Promise.resolve(t.data)},async t=>{const e=t.config;return!e||!e.retry||(e.retryCount=e.retryCount||0,e.retryCount>=N)?w(t):(e.retryCount+=1,await new Promise(o=>setTimeout(o,M)),l(e))});const Y={class:"m-4 flex flex-col gap-4"},A={class:"flex items-center justify-between gap-4 whitespace-nowrap text-sm text-stone-4 font-500 after:h-[1px] after:w-full before:h-[1px] before:w-full after:bg-stone-2 before:bg-stone-2 dark-text-stone-6 after:content-empty before:content-empty after:dark-bg-stone-6 before:dark-bg-stone-6"},K=E({__name:"loadmore",setup(t){const e=L("layoutRef"),o=i(0),p=i(10),s=i(0),a=i([]);function u(){l.get("page/loadmore",{baseURL:"/mock",params:{from:o.value*p.value,limit:p.value}}).then(c=>{a.value.push(...c.data.list),o.value+=1,s.value=c.data.total,H(()=>{var r,n,_,b;const h=((n=(r=e.value)==null?void 0:r.ref)==null?void 0:n.clientHeight)??0,f=((b=(_=e.value)==null?void 0:_.ref)==null?void 0:b.scrollHeight)??0;h===f&&a.value.length<s.value&&u()})})}function R(){a.value.length<s.value&&u()}return j(()=>{u()}),(c,h)=>{const f=T;return d(),B(f,{ref_key:"layoutRef",ref:e,navbar:"","navbar-start-side":"back",onReachBottom:R},{default:P(()=>[v("div",Y,[(d(!0),y(S,null,U(m(a),(r,n)=>(d(),y("div",{key:n,class:"bg-[var(--g-container-bg)] p-4"},k(r),1))),128)),v("div",A,k(m(a).length<m(s)?"加载更多":"已经到底啦"),1)])]),_:1},512)}}});export{K as default};
